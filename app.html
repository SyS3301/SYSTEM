<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>App Multilang</title>
  <style>
    body { font-family: sans-serif; background: #0f0f12; color: white; padding: 20px; }
    /* Стили для переключателя языков */
    .lang-switcher {
      margin-bottom: 15px;
      display: flex;
      justify-content: center;
      gap: 10px;
    }
    .lang-btn {
      background: rgba(255,255,255,0.2);
      border: 1px solid white;
      color: white;
      padding: 5px 10px;
      cursor: pointer;
      border-radius: 5px;
      text-transform: uppercase;
    }
    .lang-btn.active { background: white; color: #4f46e5; }
    #default-content { display: none; }
  </style>
</head>
<body>

  <div id="promo-container">
    <div class="lang-switcher" id="lang-btns"></div>
    <div id="promo-content"></div>
  </div>

  <div id="default-content">
    <center>
	<h1>Обычный контент</h1>
	</center>
  </div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyD6GybNkPBa28UWm9rpPhkUe8Q4JYtqQm4",
  authDomain: "system-85dfe.firebaseapp.com",
  projectId: "system-85dfe",
  storageBucket: "system-85dfe.firebasestorage.app",
  messagingSenderId: "76734526218",
  appId: "1:76734526218:web:8a9eb4e0df4a58741980f3"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

let translations = {}; // Здесь будем хранить тексты из базы

onAuthStateChanged(auth, async (user) => {
  if (!user) { window.location.href = "index.html"; return; }
  
  try {
    const snap = await getDoc(doc(db, "promo", "NuetuWkhDrGfCX8a1UxL"));
    if (snap.exists()) {
      const data = snap.data();
      const now = Date.now();
      const expiresAt = data.expiresAt?.toMillis() || 0;

      console.log("Данные получены:", data);
      debugDiv.innerText = `Status: Документ найден. Active: ${data.active}, Now: ${now}, Exp: ${expiresAt}`;

      if (data.active && now < expiresAt) {
        translations = data.html; // Теперь это объект {ru: "...", en: "..."}
        renderLangButtons();
        switchLang(Object.keys(translations)[0]); // Показываем первый доступный язык
        document.getElementById("promo-container").style.display = "block";
      } else {
        showDefault();
      }
    } else { showDefault(); }
  } catch (e) { showDefault(); }
});

function renderLangButtons() {
  const container = document.getElementById("lang-btns");
  container.innerHTML = "";
  Object.keys(translations).forEach(lang => {
    const btn = document.createElement("button");
    btn.className = "lang-btn";
    btn.innerText = lang;
    btn.onclick = () => switchLang(lang);
    container.appendChild(btn);
  });
}

function switchLang(lang) {
  document.getElementById("promo-content").innerHTML = translations[lang];
  // Подсветка активной кнопки
  document.querySelectorAll(".lang-btn").forEach(b => {
    b.classList.toggle("active", b.innerText === lang);
  });
}

function showDefault() {
  document.getElementById("default-content").style.display = "block";
}
</script>
</body>
</html>